---
title: 05 前缀和与差分
date: 2022-05-27 21:39:13
tags: 算法基础
---



# 前缀和与差分

## 1、一维前缀和

现有原数组a[] = {1,2,3,4}

可构造前缀和数组S[] = {1,3,6,10}

前缀和数组与原数组的关系是：

```
S[i] = a[0] + a[1] + ... + a[i]
```

构建前缀和数组可快速的计算某个数组a的区间和：

若需要计算数组a的在区间[l,r]的所有元素的和，我们可通过前缀和快速得到。

`S[l, r] = S[r] - S[l-1]`

### 模板：

```c++
S[i] = a[1] + a[2] + ... a[i]
a[l] + ... + a[r] = S[r] - S[l - 1]
```

#### 例题：

输入一个长度为`n`的整数序列。

接下来再输入 `m`个询问，每个询问输入一对 `l`,`r`。

对于每个询问，输出原序列中从第 `l` 个数到第 `r` 个数的和。

#### 输入格式

第一行包含两个整数 `n` 和 `m`。

第二行包含 `n` 个整数，表示整数数列。

接下来 `m` 行，每行包含两个整数 `l` 和 `r`，表示一个询问的区间范围。

#### 输出格式

共 `m` 行，每行输出一个询问的结果。

#### 数据范围

1≤l≤r≤n,
1 ≤ n,m ≤ 100000
−1000≤数列中元素的值≤1000

#### 输入样例：

```
5 3
2 1 3 6 4
1 2
1 3
2 4
```

#### 输出样例：

```
3
6
10
```

```c++
#include<iostream>
using namespace std;

const int N = 100010;
int n, m;

int a[N], S[N];

int main(){
    cin >> n >> m;
    
    //这里原数组a和前缀和数组下标都从1开始计算
    for (int i = 1; i <= n; i++) cin >> a[i];
    
    //构造前缀和
    for( int i = 1; i <= n; i++) S[i] = S[i-1] + a[i];
    
    while(m--){
        int l , r;
        cin >> l >> r;
        cout << S[r] - S[l-1] << endl;
    }
    
}
```

### 2、二维前缀和

和一维的前缀和很相似，`S[i][j]`表示`a[1][1]`与`a[i][j]`组成的矩阵中所有元素的和。

```c++
//前缀和数组的构建
S[i][j] =a[i][j] + S[i-1][j] + S[i][j-1] - S[i-1][j-1]
    
//使用前缀和数组计算区域元素和
S[x1][y1]为左上角 S[x1][y2]右上角
S[x2][y1]左下角   S[x2][y2]右下角

S[x1][y1]到S[x2][y2]之间的元素和(包含边界)
    ans = S[x2][y2] - S[x1-1][y2] - S[x2][y1-1] + S[x1-1][y1-1]
```

![](/images/image/二维前缀和.png)

上图每一个方格代表一个元素

示例：

输入一个 n行 m列的整数矩阵，再输入 q个询问，每个询问包含四个整数 x1,y1,x2,y2，表示一个子矩阵的左上角坐标和右下角坐标。

对于每个询问输出子矩阵中所有数的和。

#### 输入格式

第一行包含三个整数 n，m，q。

接下来 n行，每行包含 m个整数，表示整数矩阵。

接下来 q行，每行包含四个整数 x1,y1,x2,y2，表示一组询问。

#### 输出格式

共 q 行，每行输出一个询问的结果。

#### 数据范围

1≤n,m≤1000,
1≤q≤200000,
1≤x1≤x2≤n,
1≤y1≤y2≤m,
−1000≤矩阵内元素的值≤1000

#### 输入样例：

```
3 4 3
1 7 2 4
3 6 2 8
2 1 2 3
1 1 2 2
2 1 3 4
1 3 3 4
```

#### 输出样例：

```
17
27
21
```

```c++
#include <iostream>

using namespace std;

const int N = 1010;

int a[N][N], S[N][N];
int n, m;

int q;
int x1,y1, x2, y2;

int main(){
    
    cin >> n >> m >> q;
    
    for (int i = 1; i <= n; i++){
        for (int j = 1; j <= m; j++){
            cin >> a[i][j];
        }
    }
    
    
    // 构造矩阵前缀和
    for (int i = 1; i <= n; i++){
        for (int j = 1; j <= m; j++){
            S[i][j] = a[i][j] + S[i-1][j] + S[i][j-1] - S[i-1][j-1];
        }
    }
    
    while(q--){
        cin >> x1 >> y1 >> x2 >> y2;
        
        cout << S[x2][y2] - S[x1-1][y2] - S[x2][y1-1] + S[x1-1][y1-1] << endl;
    }
    
}
```



### 3、一维差分

给定原数组a[]，构建差分数组b，使得a数组是b数组的前缀和，主要用来解决的问题：若想让a数组在区间[l, r]上加上一个数C，那么等价于b[l] += C, b[r+1] -= C

```
给区间[l, r]中的每个数加上c：B[l] += c, B[r + 1] -= c
```

#### 样题：

输入一个长度为 n 的整数序列。

接下来输入 m个操作，每个操作包含三个整数 l,r,c表示将序列中 [l,r] 之间的每个数加上 c。

请你输出进行完所有操作后的序列。

#### 输入格式

第一行包含两个整数 n 和 m。

第二行包含 n 个整数，表示整数序列。

接下来 m 行，每行包含三个整数 l，r，c，表示一个操作。

#### 输出格式

共一行，包含 n 个整数，表示最终序列。

#### 数据范围

1≤n,m≤100000,
1≤l≤r≤n,
−1000≤c≤1000,
−1000≤整数序列中元素的值≤1000

#### 输入样例：

```
6 3
1 2 2 1 2 1
1 3 1
3 5 1
1 6 1
```

#### 输出样例：

```
3 4 5 3 4 2
```

#### 题解：

```c++
#include <iostream>

using namespace std;

const int N = 100010;
int a[N],b[N];

int m, n;

int main(){
    
    cin >> n >> m;
    
    for (int i = 1; i <= n; i++) cin >> a[i];
    
    // 构建差分数组
    for(int i = 1; i <= n; i++) b[i] = a[i] - a[i-1];
    
    while(m--){
        
        int l, r, c;
        cin >> l >> r >> c;
        
        b[l] += c;
        b[r+1] -= c;
    }
    
    for( int i = 1; i <= n; i++){
            b[i] += b[i-1];
            cout << b[i] << " ";
        }cout << endl;
}
```

或者做一个单独的插入函数，在构建差分和差分计算时使用。

```c++
#include <iostream>

using namespace std;

const int N = 100010;
int a[N],b[N];

int m, n;

void insert(int l, int r, int c){
    b[l] += c;
    b[r + 1] -= c;
}

int main(){
    
    cin >> n >> m;
    
    for (int i = 1; i <= n; i++) cin >> a[i];
    
    // 构建差分数组
    // 使用insert函数来构建差分数组。
    // 默认新建差分数组中元素默认为0，b[i] += a[i], b[i+1] -= a[i]，这样等价于b[i] = a[i] - a[i-1]
    for(int i = 1; i <= n; i++) insert(i, i, a[i]);
    
    while(m--){
        
        int l, r, c;
        cin >> l >> r >> c;
        
        insert(l ,r, c);
    }
    
    for( int i = 1; i <= n; i++){
            b[i] += b[i-1];
            cout << b[i] << " ";
        }cout << endl;
}
```



### 4、二维差分

给定原矩阵a[i, j]，构造差分矩阵b[i, j]，使得a[]是b[]的前缀和

核心操作是：

​	以(x1,y1)为左上角，(x2, y2)为右上角的子矩阵中的所有数a[i, j]加上c，这样对于差分数组的影响就是：

```
b[x1, y1] += c

b[x1, y2 + 1] -= c

b[x2 + 1, y1] -= c

b[x2 + 1, y2 + 1] += c
```

样题：

输入一个 n 行 m 列的整数矩阵，再输入 q 个操作，每个操作包含五个整数 x1,y1,x2,y2c，其中 (x1,y1) 和 (x2,y2)表示一个子矩阵的左上角坐标和右下角坐标。

每个操作都要将选中的子矩阵中的每个元素的值加上 cc。

请你将进行完所有操作后的矩阵输出。

#### 输入格式

第一行包含整数 n,m,q。

接下来 n 行，每行包含 m 个整数，表示整数矩阵。

接下来 q 行，每行包含 55 个整数 x1,x2,,c，表示一个操作。

#### 输出格式

共 n 行，每行 m 个整数，表示所有操作进行完毕后的最终矩阵。

#### 数据范围

1≤n,m≤1000,
1≤q≤100000,
1≤x1≤x2≤n,
1≤y1≤y2≤m,
−1000≤c≤1000,
−1000≤矩阵内元素的值≤1000

#### 输入样例：

```
3 4 3
1 2 2 1
3 2 2 1
1 1 1 1
1 1 2 2 1
1 3 2 3 2
3 1 3 4 1
```

#### 输出样例：

```
2 3 4 1
4 3 4 1
2 2 2 2
```

```c++
#include <iostream>

using namespace std;

const int N = 1010;

int n, m, q;

int a[N][N], b[N][N];

void insert(int x1, int y1, int x2, int y2, int c){
    b[x1][y1] += c;
    b[x1][y2 + 1] -= c;
    b[x2 + 1][y1] -= c;
    b[x2 + 1][y2 + 1] += c;
}


int main(){
    
    cin >> n >> m >> q;
    
    // 输入
    for (int i = 1; i <= n; i++){
        for (int j = 1; j <= m; j++){
            cin >> a[i][j];
        }
    }
    
    // 构建差分数组
    for (int i = 1; i <= n; i++){
        for (int j = 1; j <= m; j++){
            insert(i, j, is, j, a[i][j]);
        }
    }
    
    // 询问操作
    while(q--){
        
        int x1, y1, x2, y2, c;
        cin >> x1 >> y1 >> x2 >> y2 >> c;
        
        insert(x1, y1, x2, y2, c);
    }
    
    //前缀和公式还原a[]
    for (int i = 1; i <= n; i++){
        for(int j = 1; j <= m; j++){
            a[i][j] = a[i-1][j] + a[i][j-1] - a[i-1][j-1] + b[i][j];
            cout << a[i][j] << " ";
        }cout << endl;
    }
}
```

