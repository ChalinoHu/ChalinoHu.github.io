---
title: 29 线程池
date: 2022-05-27 21:02:46
tags: linux环境编程
---



# 线程池

​	线程池是由服务器预先创建的一组子线程，线程池中的线程数量应该和 CPU 数量差不多。线程池中的所有子线程都运行着相同的代码。当有新的任务到来时，主线程将通过某种方式选择线程池中的某一个子 线程来为之服务。

​	相比于动态的创建线程，选择一个已经存在的线程执行程序的代价要小得多。

**选择子线程的方式：**

- 主线程使用某种算法来主动选择子线程。最简单、最常用的算法是随机算法和 Round Robin（轮流 选取）算法，但更优秀、更智能的算法将使任务在各个工作线程中更均匀地分配，从而减轻服务器 的整体压力。
- 主线程和子线程通过一个共享的工作队列来同步，子线程睡眠在该工作队列上。当有新任务来时，主线程将任务添加到工作队列中。这将唤醒正在等待任务的子线程，不过只有一个子线程获得该任务的接管权。它将任务从工作队列中取出并执行。其他没有接管任务的子线程将继续睡眠等待有任务将其唤醒。

**线程池的特点**：

- 空间换时间，使用服务器的空间资源，换取运行效率。
- 池是一组资源的集合，这组资源在服务器运行之初就完全创建好并初始化，这称为静态资源池。
- 当服务器进入到正式运行阶段，开始处理客户请求时，如果需要相关的资源可直接从池中获取，无需动态分配。
- 当服务器处理完一个客户连接后，可以把相关的资源放回池中，无需执行系统调用释放资源。

**线程池中的线程数量**：

线程池中限制线程数量的核心因素是**核心处理器的个数N**

- 对于**CPU密集型**的任务（如视频剪辑等消耗CPU资源的任务），线程池中的线程数最好也设置为N（或者+1防止其他因素造成的阻塞）
- 对于**IO密集型**的任务，一般对于CPU的核心数，因为线程间竞争的资源不是CPU而是IO，IO处理一般比较慢，对于CPU处理器核心数的线程将为CPU争取更多的的任务，不至于在线程处理IO过程中造成CPU空闲导致资源浪费。

