---
title: 05 GDB调式过程
date: 2022-05-27 21:02:46
tags: linux环境编程
---



# GDB调试

### 一、调试前的准备工作：

1、`-O`关闭GCC编译器的优化选项，其中`-O0 、-O1 、-O2 、-O3`

编译器的优化选项的 4 个级别，-O0 表示没有优化, -O1 为默认值，-O3 优化级别最高。

2、`-g`打开调试选项，输出文件中带有调试信息，例如在可执行文件中加入源代码的信息，例如可执行文件中的机器指定对应源代码中第几行，但不把整个源文件嵌入到可执行文件中，因此在调试时必须保证GDB能找到对应的源文件。

3、`-Wall`尽量在不影响程序运行的情况下打开所有的warning

```shell
gcc -g -Wall program.c -o program
```

### 二、常用命令

1、开始调试

```shell
gdb program
```

2、退出调试

```
quit 或者 q
```

3、设定参数

```
set 参数名 参数值
```

其中参数有多个值用空格分开

4、查看参数

```
show 参数名
```

5、查看代码

```
list 或 l
```

默认显示main函数所在文件的代码，默认显示前10行，若要读取10行之后的代码，可再次输入`list` 或者简写指令 `l`显示接下来的10行。

6、指定行查看代码

```
# list/l 行号
l 20
```

打印15到24行的代码，20行放中间，查看20行的上下文信息

7、查看指定函数

```
l main
```

查看main函数的上下文信息

8、查看非当前文件的代码

```
list/l 文件名:行号
```

```
list/l 文件名:函数名
```

9、设置显示的行数

```
show list/listsize
```

```
set list/listsize 20
```

之后每次可显示20行的代码

### 三、断点命令

1、设置断点

```
b/break 行号
b/break 函数名
b/break 文件名:行号
b/break 文件名:函数名
```

2、查看断点的信息

```
i/info b/break
```

3、删除断点

```
d/del/delete 断点编号
```

4、设置断点无效

```
dis/disable 断点编号
```

5、设置断点生效

```
ena/enable 断点编号
```

6、设置条件断点(一般用在循环位置)

```c++
15 for(int i = 0; i < 10; i++){
16 cout << array[i] << endl;
17 }
```

我们可以选择循环中当i为3时在16行打上断点

```shell
b 16 if i=3
```

### 四、调试断点

1、运行GDB程序

```
start (程序开始运行并停在第一行)
```

```
run (程序遇到断点再停下来)
```

2、继续运行，到下一个断点再停止

```
c/continue
```

3、向下执行一行代码(不会进入函数体)

```
n/next
```

4、向下单步调试（遇到函数进入函数体内部）

```
s/step

finish (跳出函数体)
```

5、变量操作

```
p/print 变量名     打印变量名
ptype 变量名		打印变量名类型
```

6、自动变量操作

```
display 变量名		自动打印指定变量的值
i/info display
undisplay 编号
```

7、其他操作

```
set var 变量名=变量值
until 	跳出循环
```

跳出循环需要保证当前循环中没有其他断点，否则在执行跳出循环时会在断点处停止，跳出函数也是如此，也需要该函数体内没有其他断点。