---
title: 26 同步与阻塞
date: 2022-05-27 21:02:46
tags: linux环境编程
---



# 网络IO的同步与阻塞

进行一次网络IO主要有两个阶段：**数据就绪**和**数据读写**

> 在数据就绪阶段，线程可能发生阻塞和非阻塞两种状态。一般在操作系统对TCP接收缓冲区的读写操作上考虑阻塞与非阻塞问题。
>
> 阻塞：调用IO方法的线程进入阻塞状态，如`recv`函数，数据没有到到达则该线程可能会挂起而处于阻塞状态。
>
> 非阻塞：不会改变线程的状态，一般通过返回值进行判断。

> 数据读写阶段，对数据的读取有同步和异步两种方式。一般是在应用程序中考虑。
>
> 同步一般是我们主动去读写，如`recv`函数的调用，我们需要定义`buf`数组来接受数据，将数据从TCP缓冲区读到内存中，这种行为一般称为同步。即数据准备好之后，在应用程序中对数据的读写是我们自己去读写的。
>
> 异步则是操作系统帮我们完成数据的读取。当TCP缓冲区的数据到了之后，操作系统会帮我们将数据搬到内存的一块地方。在操作系统做这件事之前我们需要传给操作系统<u>`sockfd`</u>、<u>`buf`</u>、<u>通知方式(`sigio`信号</u>)。与操作系统定义好接口之后应用程序就可以去执行别的任务。

在处理IO时，阻塞和非阻塞都是同步IO，只有使用了特殊的`API`才是异步IO，如`aio_read()`, `aio_write()`。异步一般和非阻塞结合使用。

